---
- name: download collectd source
  get_url: >-
    url={{collectd_tgz_url}}
    dest=/tmp/{{collectd_tgz}}
    owner=root
    group=root
    mode=644

- name: unarchive...
  unarchive: >-
    copy=no
    src=/tmp/{{collectd_tgz}}
    dest=/opt
    owner=root
    group=root

- name: configure...
  command: ./configure --prefix={{collectd_target_dir}}
  args:
    chdir: '{{collectd_src_dir}}'
    creates: /opt/{{collectd_name}}/Makefile

- name: make all install...
  command: make all install
  args:
    chdir: '{{collectd_src_dir}}'
    creates: '{{collectd_target_dir}}/sbin/collectd'

- name: cleanup...
  when: collectd_build_clean
  command: rm -rf '{{collectd_src_dir}}'